<!doctype html>
<html lang="pt-BR" class="h-full antialiased">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cat√°logo de Lingerie | Belle Lingerie</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['"Inter"', 'sans-serif'],
                        display: ['"Inter"', 'sans-serif'],
                    },
                    colors: {
                        ios: {
                            black: '#000000',
                            card: '#1c1c1e',
                            gray: '#8e8e93',
                            blue: '#0a84ff',
                            purple: '#bf5af2',
                            red: '#ff453a',
                            green: '#30d158',
                            divider: '#38383a'
                        }
                    },
                    animation: {
                        'fade-in': 'fadeIn 0.6s cubic-bezier(0.16, 1, 0.3, 1) forwards',
                        'scale-in': 'scaleIn 0.4s cubic-bezier(0.16, 1, 0.3, 1) forwards',
                        'subtle-zoom': 'subtleZoom 15s ease-in-out infinite alternate',
                        'explosion': 'explosion 2s ease-in-out infinite',
                        'blob': 'blob 10s infinite',
                    },
                    keyframes: {
                        fadeIn: {
                            '0%': { opacity: 0, transform: 'translateY(10px)' },
                            '100%': { opacity: 1, transform: 'translateY(0)' },
                        },
                        scaleIn: {
                            '0%': { opacity: 0, transform: 'scale(0.95)' },
                            '100%': { opacity: 1, transform: 'scale(1)' },
                        },
                        subtleZoom: {
                            '0%': { transform: 'scale(1)', opacity: '0.2' },
                            '100%': { transform: 'scale(1.15)', opacity: '0.3' },
                        },
                        explosion: {
                            '0%, 100%': { transform: 'scale(1)', 'text-shadow': 'none', 'letter-spacing': 'normal' },
                            '50%': { 
                                transform: 'scale(1.1)', 
                                'text-shadow': '0 0 20px rgba(255,255,255,0.8), 0 0 40px rgba(191, 90, 242, 0.4)', 
                                'letter-spacing': '0.05em' 
                            }
                        },
                        blob: {
                            '0%': { transform: 'translate(0px, 0px) scale(1)' },
                            '33%': { transform: 'translate(30px, -50px) scale(1.1)' },
                            '66%': { transform: 'translate(-20px, 20px) scale(0.9)' },
                            '100%': { transform: 'translate(0px, 0px) scale(1)' }
                        }
                    }
                }
            }
        }
    </script>

    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #000000;
            color: #f5f5f7;
            -webkit-font-smoothing: antialiased;
        }

        .glass-nav {
            background-color: rgba(28, 28, 30, 0.6);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.08);
        }

        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .no-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        .tap-highlight-transparent {
            -webkit-tap-highlight-color: transparent;
        }

        .btn-ios {
            transition: all 0.2s cubic-bezier(0.25, 1, 0.5, 1);
        }
        .btn-ios:active {
            transform: scale(0.96);
            opacity: 0.8;
        }
        
        .admin-checkbox:checked + div {
            border-color: #0a84ff;
            background-color: rgba(10, 132, 255, 0.2);
        }

        .toggle-checkbox:checked {
            right: 0;
            border-color: #30d158;
        }
        .toggle-checkbox:checked + .toggle-label {
            background-color: #30d158;
        }
    </style>
</head>

<body class="h-full bg-black text-white selection:bg-ios-blue selection:text-white relative">
    
    <!-- Background Din√¢mico Luxuoso & Misterioso -->
    <div class="fixed inset-0 w-full h-full overflow-hidden pointer-events-none z-0">
        <div class="absolute inset-0 bg-black"></div>
        <div class="absolute top-[-10%] left-[-10%] w-[70vw] h-[70vw] bg-purple-900/20 rounded-full mix-blend-screen filter blur-[120px] animate-blob"></div>
        <div class="absolute top-[-10%] right-[-10%] w-[70vw] h-[70vw] bg-rose-900/20 rounded-full mix-blend-screen filter blur-[120px] animate-blob" style="animation-delay: 2s"></div>
        <div class="absolute -bottom-32 left-[20%] w-[70vw] h-[70vw] bg-yellow-900/10 rounded-full mix-blend-screen filter blur-[120px] animate-blob" style="animation-delay: 4s"></div>
        <div class="absolute inset-0 bg-[url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0IiBoZWlnaHQ9IjQiPgo8cmVjdCB3aWR0aD0iNCIgaGVpZ2h0PSI0IiBmaWxsPSIjMDAwIi8+CjxyZWN0IHdpZHRoPSIxIiBoZWlnaHQ9IjEiIGZpbGw9InJnYmEoMjU1LDI1NSwyNTUsMC4wNSkiLz4KPC9zdmc+')] opacity-20"></div>
    </div>

    <!-- Container principal com z-index para ficar acima do fundo -->
    <div id="app" class="h-full overflow-y-auto overflow-x-hidden relative z-10">
        
        <!-- Navbar -->
        <header class="glass-nav sticky top-0 z-50 transition-all duration-300">
            <div class="max-w-[980px] mx-auto px-5 h-[52px] flex items-center justify-between">
                <!-- Left: Logo -->
                <div class="cursor-pointer" onclick="window.scrollTo({top: 0, behavior: 'smooth'})">
                    <img src="https://i.imgur.com/4mPLGSA.png" alt="Belle Lingerie" class="h-8 md:h-10 w-auto object-contain">
                </div>

                <!-- Right: Bag -->
                <button id="cart-btn" class="text-gray-400 hover:text-white transition-colors p-2 -mr-2 relative group">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z" />
                    </svg>
                    <span id="cart-count" class="absolute top-1 right-1 bg-ios-blue text-white text-[9px] w-3.5 h-3.5 rounded-full flex items-center justify-center font-bold hidden shadow-sm">0</span>
                </button>
            </div>
        </header>

        <!-- Hero Section -->
        <section class="pt-24 pb-16 px-6 text-center max-w-[980px] mx-auto">
            <div class="animate-fade-in">
                <p id="hero-collection-title" class="text-ios-purple font-bold text-xl md:text-2xl mb-4 tracking-widest uppercase animate-explosion">Nova Cole√ß√£o</p>
                <h2 class="text-5xl md:text-7xl font-bold tracking-tight text-white mb-6 leading-tight drop-shadow-2xl">
                    Eleg√¢ncia.<br>Redefinida.
                </h2>
                <p class="text-xl md:text-2xl text-gray-300 font-normal max-w-xl mx-auto mb-10 leading-relaxed drop-shadow-md">
                    Conforto absoluto e design sofisticado para todos os seus momentos.
                </p>
                
                <button onclick="document.getElementById('products-section').scrollIntoView({behavior: 'smooth'})" class="bg-white text-black px-10 py-4 rounded-full font-bold hover:bg-gray-100 transition-colors btn-ios text-2xl shadow-[0_0_20px_rgba(255,255,255,0.4)]">
                    Ver Cole√ß√£o
                </button>
            </div>
            
            <!-- Hero Visual (Video) -->
            <div class="mt-16 relative h-[400px] md:h-[500px] w-full rounded-3xl overflow-hidden bg-ios-card/50 animate-fade-in shadow-2xl border border-white/10 backdrop-blur-sm" style="animation-delay: 0.2s;">
                <video autoplay loop muted playsinline class="absolute inset-0 w-full h-full object-cover opacity-80">
                    <source src="https://i.imgur.com/hfHisyM.mp4" type="video/mp4">
                    Seu navegador n√£o suporta a tag de v√≠deo.
                </video>
                <div class="absolute inset-0 bg-black/20"></div>
                
                <div class="absolute inset-0 flex items-center justify-center">
                    <span class="text-8xl md:text-9xl opacity-30 font-bold tracking-tighter text-white mix-blend-overlay select-none animate-subtle-zoom">BELLE</span>
                </div>
            </div>
        </section>

        <!-- Sticky Filter Bar -->
        <div id="products-section" class="sticky top-[52px] z-40 bg-black/60 backdrop-blur-xl border-b border-white/5 py-4">
            <div class="max-w-[980px] mx-auto px-5">
                <div id="categories" class="flex items-center gap-2 overflow-x-auto no-scrollbar tap-highlight-transparent">
                    <!-- Categories rendered via JS -->
                </div>
            </div>
        </div>

        <!-- Promotions Section -->
        <section id="promotions-section" class="max-w-[980px] mx-auto px-5 pt-10 hidden">
            <h3 class="text-xl font-bold text-white mb-4 flex items-center gap-2 drop-shadow-md">
                <span class="text-ios-red">üî•</span> Ofertas Especiais
            </h3>
            <div id="promotions-list" class="flex gap-4 overflow-x-auto no-scrollbar pb-4 snap-x">
                <!-- Rendered by JS -->
            </div>
        </section>

        <!-- Products Grid -->
        <main class="max-w-[980px] mx-auto px-5 py-12 pb-32">
            <h3 class="text-xl font-bold text-white mb-6 hidden drop-shadow-md" id="catalog-title">Cat√°logo</h3>
            <div id="products-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
                <!-- Rendered by JS -->
            </div>
        </main>

        <!-- Footer -->
        <footer class="bg-ios-card/80 backdrop-blur-lg py-20 text-center border-t border-white/5">
            <div class="max-w-[980px] mx-auto px-5 flex flex-col items-center">
                
                <!-- Instagram Icon -->
                <a href="https://instagram.com/nqsecrets" target="_blank" class="group flex flex-col items-center gap-3 text-gray-500 hover:text-white transition-colors duration-300 mb-10">
                    <div class="p-4 rounded-3xl bg-white/5 group-hover:bg-white/10 border border-white/5 group-hover:border-white/10 transition-all duration-300 scale-100 group-hover:scale-105 shadow-sm">
                        <svg class="w-7 h-7" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                            <rect x="2" y="2" width="20" height="20" rx="5" ry="5"></rect>
                            <path d="M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z"></path>
                            <line x1="17.5" y1="6.5" x2="17.51" y2="6.5"></line>
                        </svg>
                    </div>
                    <span class="text-xs font-medium tracking-wide uppercase text-gray-600 group-hover:text-gray-400 transition-colors">@nqsecrets</span>
                </a>
                
                <div class="w-full max-w-sm border-t border-white/5 pt-8 flex justify-between items-center">
                    <div class="text-left">
                        <p class="text-[11px] text-gray-600">Copyright ¬© 2026 nq secrets.</p>
                        <p class="text-[11px] text-gray-700 mt-1">Todos os direitos reservados.</p>
                    </div>
                    
                    <!-- Admin Button -->
                    <button onclick="openAdminLogin()" class="text-gray-700 hover:text-white transition-colors p-2" title="√Årea Administrativa">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" />
                        </svg>
                    </button>
                </div>
            </div>
        </footer>

        <!-- Product Modal -->
        <div id="product-modal" class="fixed inset-0 z-50 hidden" role="dialog" aria-modal="true">
            <div class="fixed inset-0 bg-black/60 backdrop-blur-sm transition-opacity opacity-0" id="modal-backdrop"></div>
            <div class="fixed inset-0 overflow-hidden">
                <div class="absolute inset-0 overflow-hidden">
                    <div class="pointer-events-none fixed inset-y-0 right-0 flex max-w-full pl-0 sm:pl-10">
                        <div class="pointer-events-auto w-screen max-w-md transform transition ease-in-out duration-500 translate-x-full" id="modal-panel">
                            <div class="flex h-full flex-col overflow-y-scroll bg-ios-card/95 backdrop-blur-xl shadow-2xl">
                                <div id="modal-content" class="h-full flex flex-col"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Checkout Modal -->
        <div id="checkout-modal" class="fixed inset-0 z-[60] hidden">
            <div class="absolute inset-0 bg-black/60 backdrop-blur-sm transition-opacity" id="checkout-overlay"></div>
            <div class="relative h-full flex items-center justify-center p-4">
                <div class="bg-ios-card w-full max-w-sm rounded-[2rem] shadow-2xl overflow-hidden transform transition-all scale-95 opacity-0" id="checkout-panel">
                    <div id="checkout-modal-content"></div>
                </div>
            </div>
        </div>

        <!-- Cart Sidebar -->
        <div id="cart-sidebar" class="fixed inset-y-0 right-0 w-full md:w-[400px] bg-ios-card/95 backdrop-blur-xl shadow-2xl z-50 transform translate-x-full transition-transform duration-500 border-l border-white/5">
            <div class="h-full flex flex-col">
                <div class="px-6 py-5 border-b border-white/5 flex items-center justify-between bg-white/5 backdrop-blur-md sticky top-0 z-10">
                    <h2 class="text-lg font-semibold text-white">Sacola</h2>
                    <button id="close-cart" class="text-gray-400 hover:text-white bg-white/10 rounded-full p-1.5 transition-colors">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
                    </button>
                </div>
                
                <div id="cart-items" class="flex-1 overflow-y-auto p-6 space-y-6"></div>
                
                <div class="p-6 border-t border-white/5 bg-black/20 backdrop-blur-lg space-y-4">
                    <div class="flex gap-2">
                        <input type="text" id="coupon-input" placeholder="Cupom de desconto" class="flex-1 bg-black/50 border border-white/10 rounded-lg px-3 py-2 text-sm text-white focus:border-ios-blue outline-none">
                        <button onclick="applyCoupon()" class="bg-white/10 hover:bg-white/20 text-white px-4 py-2 rounded-lg text-sm font-medium transition-colors">Aplicar</button>
                    </div>
                    <div id="coupon-message" class="text-xs hidden"></div>

                    <div class="flex justify-between items-center">
                        <span class="text-gray-400 text-sm">Total Estimado</span>
                        <div class="text-right">
                             <div id="discount-display" class="text-xs text-ios-green hidden"></div>
                             <span id="cart-total" class="text-xl font-bold text-white">R$ 0,00</span>
                        </div>
                    </div>
                    <button id="checkout-btn" class="w-full bg-ios-blue text-white py-3.5 rounded-xl font-semibold text-sm hover:bg-blue-600 transition-colors btn-ios disabled:opacity-50 disabled:cursor-not-allowed">
                        Finalizar no WhatsApp
                    </button>
                </div>
            </div>
        </div>

        <!-- Admin Login Modal -->
        <div id="admin-login-modal" class="fixed inset-0 z-[70] hidden">
            <div class="absolute inset-0 bg-black/80 backdrop-blur-md" onclick="closeAdminLogin()"></div>
            <div class="relative h-full flex items-center justify-center p-4">
                <div class="bg-ios-card w-full max-w-sm rounded-3xl p-8 shadow-2xl border border-white/10">
                    <h3 class="text-xl font-bold text-white mb-2 text-center">√Årea Administrativa</h3>
                    <p class="text-gray-500 text-sm mb-6 text-center">Digite a senha de acesso</p>
                    <input type="password" id="admin-password-input" class="w-full bg-black/50 border border-white/10 rounded-xl px-4 py-3 text-white mb-4 focus:border-ios-blue outline-none text-center tracking-widest" placeholder="Senha">
                    <button onclick="checkAdminPassword()" class="w-full bg-white text-black font-bold py-3 rounded-xl hover:bg-gray-200 transition-colors">Entrar</button>
                </div>
            </div>
        </div>

        <!-- Admin Dashboard Modal -->
        <div id="admin-dashboard-modal" class="fixed inset-0 z-[80] hidden bg-black/95 backdrop-blur-xl">
            <div class="h-full flex flex-col">
                <header class="border-b border-white/10 p-4 flex justify-between items-center bg-ios-card/50">
                    <h2 class="text-xl font-bold text-white flex items-center gap-2">
                        <span class="text-ios-blue">üîí</span> Painel Administrativo
                    </h2>
                    <button onclick="closeAdminDashboard()" class="text-gray-400 hover:text-white">Sair</button>
                </header>
                
                <div class="flex-1 overflow-hidden flex">
                    <!-- Sidebar -->
                    <aside class="w-64 bg-ios-card/50 border-r border-white/5 hidden md:block p-4 space-y-2">
                        <button onclick="switchAdminTab('products')" class="w-full text-left px-4 py-2 rounded-lg text-white hover:bg-white/5 transition-colors font-medium bg-white/10" id="tab-btn-products">Produtos</button>
                        <button onclick="switchAdminTab('categories')" class="w-full text-left px-4 py-2 rounded-lg text-gray-400 hover:bg-white/5 transition-colors font-medium" id="tab-btn-categories">Categorias</button>
                        <button onclick="switchAdminTab('coupons')" class="w-full text-left px-4 py-2 rounded-lg text-gray-400 hover:bg-white/5 transition-colors font-medium" id="tab-btn-coupons">Cupons</button>
                        <button onclick="switchAdminTab('settings')" class="w-full text-left px-4 py-2 rounded-lg text-gray-400 hover:bg-white/5 transition-colors font-medium" id="tab-btn-settings">Configura√ß√µes</button>
                    </aside>
                    
                    <!-- Content -->
                    <main class="flex-1 overflow-y-auto p-6 relative">
                        <div class="md:hidden flex gap-2 mb-6 overflow-x-auto pb-2">
                            <button onclick="switchAdminTab('products')" class="px-4 py-2 rounded-full bg-ios-blue text-white text-sm whitespace-nowrap">Produtos</button>
                            <button onclick="switchAdminTab('categories')" class="px-4 py-2 rounded-full bg-white/10 text-white text-sm whitespace-nowrap">Categorias</button>
                            <button onclick="switchAdminTab('coupons')" class="px-4 py-2 rounded-full bg-white/10 text-white text-sm whitespace-nowrap">Cupons</button>
                            <button onclick="switchAdminTab('settings')" class="px-4 py-2 rounded-full bg-white/10 text-white text-sm whitespace-nowrap">Configura√ß√µes</button>
                        </div>

                        <!-- Products Tab -->
                        <div id="admin-tab-products" class="space-y-6">
                            <div class="flex justify-between items-center">
                                <h3 class="text-2xl font-bold text-white">Produtos</h3>
                                <button onclick="openProductForm()" class="bg-ios-green text-white px-4 py-2 rounded-lg text-sm font-bold hover:bg-green-600">+ Novo Produto</button>
                            </div>
                            <div id="admin-products-list" class="grid grid-cols-1 gap-4"></div>
                        </div>

                        <!-- Categories Tab -->
                        <div id="admin-tab-categories" class="hidden space-y-6">
                            <h3 class="text-2xl font-bold text-white">Categorias</h3>
                            <div class="flex gap-2">
                                <input type="text" id="new-cat-input" placeholder="Nova Categoria (ID)" class="bg-white/5 border border-white/10 rounded-lg px-4 py-2 text-white flex-1">
                                <input type="text" id="new-cat-label" placeholder="Nome Exibi√ß√£o" class="bg-white/5 border border-white/10 rounded-lg px-4 py-2 text-white flex-1">
                                <button onclick="addCategory()" class="bg-ios-blue px-4 py-2 rounded-lg text-white font-bold">Adicionar</button>
                            </div>
                            <div id="admin-categories-list" class="space-y-2"></div>
                        </div>

                        <!-- Coupons Tab -->
                        <div id="admin-tab-coupons" class="hidden space-y-6">
                            <h3 class="text-2xl font-bold text-white">Cupons & Promo√ß√µes</h3>
                            <div class="flex gap-2 flex-wrap">
                                <input type="text" id="new-coupon-code" placeholder="C√≥digo (Ex: PROMO10)" class="bg-white/5 border border-white/10 rounded-lg px-4 py-2 text-white flex-1 min-w-[150px] uppercase">
                                <input type="number" id="new-coupon-val" placeholder="Desconto (%)" class="bg-white/5 border border-white/10 rounded-lg px-4 py-2 text-white w-24">
                                <button onclick="addCoupon()" class="bg-ios-blue px-4 py-2 rounded-lg text-white font-bold">Criar Cupom</button>
                            </div>
                            <div id="admin-coupons-list" class="space-y-2"></div>
                        </div>

                        <!-- Settings Tab -->
                        <div id="admin-tab-settings" class="hidden space-y-6">
                            <h3 class="text-2xl font-bold text-white">Configura√ß√µes da Loja</h3>
                            <div class="bg-white/5 p-6 rounded-2xl border border-white/10">
                                <label class="block text-sm font-bold text-gray-400 mb-3">Nome da Cole√ß√£o (Hero Section)</label>
                                <div class="flex gap-3">
                                    <input type="text" id="setting-collection-title" class="bg-black/50 border border-white/10 rounded-xl px-4 py-3 text-white flex-1 focus:border-ios-blue outline-none" placeholder="Ex: Nova Cole√ß√£o">
                                    <button onclick="saveSettings()" class="bg-ios-blue px-6 py-2 rounded-xl text-white font-bold hover:bg-blue-600 transition-colors">Salvar</button>
                                </div>
                                <p class="text-xs text-gray-500 mt-2">Altera o texto pequeno roxo acima do t√≠tulo principal.</p>
                            </div>
                        </div>
                    </main>
                </div>
            </div>

            <!-- Product Form Modal -->
            <div id="admin-product-form" class="absolute inset-0 bg-ios-card z-50 hidden flex flex-col">
                <div class="p-4 border-b border-white/10 flex justify-between items-center">
                    <h3 class="text-lg font-bold text-white">Editar/Criar Produto</h3>
                    <button onclick="closeProductForm()" class="text-gray-400 hover:text-white">Cancelar</button>
                </div>
                <div class="p-6 overflow-y-auto space-y-4 max-w-2xl mx-auto w-full">
                    <input type="hidden" id="edit-prod-id">
                    <div>
                        <label class="block text-xs text-gray-500 mb-1">Nome</label>
                        <input type="text" id="prod-name" class="w-full bg-white/5 border border-white/10 rounded-lg p-3 text-white">
                    </div>
                    <div class="flex gap-4">
                        <div class="flex-1">
                            <label class="block text-xs text-gray-500 mb-1">Pre√ßo Original (R$)</label>
                            <input type="number" step="0.01" id="prod-price" class="w-full bg-white/5 border border-white/10 rounded-lg p-3 text-white">
                        </div>
                        <div class="flex-1">
                            <label class="block text-xs text-gray-500 mb-1">Categoria</label>
                            <select id="prod-category" class="w-full bg-white/5 border border-white/10 rounded-lg p-3 text-white"></select>
                        </div>
                    </div>
                    <div>
                        <label class="block text-xs text-gray-500 mb-1">Link da Imagem (Imgur)</label>
                        <input type="text" id="prod-image" class="w-full bg-white/5 border border-white/10 rounded-lg p-3 text-white" placeholder="https://i.imgur.com/...">
                        <p class="text-[10px] text-gray-500 mt-1">Cole o link da p√°gina ou imagem do Imgur.</p>
                    </div>
                    <div>
                        <label class="block text-xs text-gray-500 mb-1">√çcone (Emoji - Fallback)</label>
                        <input type="text" id="prod-icon" class="w-full bg-white/5 border border-white/10 rounded-lg p-3 text-white">
                    </div>
                    <div>
                        <label class="block text-xs text-gray-500 mb-1">Descri√ß√£o</label>
                        <textarea id="prod-desc" rows="3" class="w-full bg-white/5 border border-white/10 rounded-lg p-3 text-white"></textarea>
                    </div>

                    <div class="bg-white/5 p-4 rounded-xl border border-white/10 space-y-3">
                        <div class="flex items-center gap-3">
                            <input type="checkbox" id="prod-is-promo" class="w-5 h-5 rounded border-gray-600 bg-black text-ios-blue focus:ring-ios-blue">
                            <label for="prod-is-promo" class="text-sm font-bold text-white">Produto em Promo√ß√£o</label>
                        </div>
                        <div>
                            <label class="block text-xs text-gray-500 mb-1">Pre√ßo Promocional (R$)</label>
                            <input type="number" step="0.01" id="prod-promo-price" class="w-full bg-black/50 border border-white/10 rounded-lg p-3 text-white placeholder-gray-600" placeholder="Valor com desconto">
                        </div>
                    </div>

                    <div class="bg-white/5 p-4 rounded-xl border border-white/10">
                        <label class="block text-sm font-bold text-white mb-3">Tabela de Cores Dispon√≠veis</label>
                        <div class="grid grid-cols-2 sm:grid-cols-3 gap-3" id="color-selection-grid"></div>
                    </div>

                    <button onclick="saveProduct()" class="w-full bg-ios-blue text-white font-bold py-4 rounded-xl mt-4">Salvar Produto</button>
                    <button onclick="deleteProduct()" id="btn-delete-prod" class="w-full bg-ios-red/10 text-ios-red font-bold py-3 rounded-xl hidden">Excluir Produto</button>
                </div>
            </div>
        </div>
        
    </div>

    <script>
        // Imgur Link Auto-Fixer
        function getValidImageUrl(url) {
            if (!url) return null;
            // Check if it's an Imgur link but NOT a direct image file
            if (url.includes('imgur.com') && !url.match(/\.(jpeg|jpg|gif|png|webp|mp4)$/i)) {
                // Extract ID (last part of URL)
                const parts = url.split('/');
                const id = parts[parts.length - 1];
                // Return valid direct link
                return `https://i.imgur.com/${id}.png`;
            }
            return url;
        }

        // IndexedDB Wrapper
        const dbName = "BelleLingerieDB";
        const dbVersion = 1;
        let db;

        const IDB = {
            async open() {
                return new Promise((resolve, reject) => {
                    const request = indexedDB.open(dbName, dbVersion);
                    request.onerror = (e) => reject("DB Error: " + e.target.errorCode);
                    request.onupgradeneeded = (e) => {
                        const db = e.target.result;
                        if (!db.objectStoreNames.contains('products')) db.createObjectStore('products', { keyPath: 'id' });
                        if (!db.objectStoreNames.contains('categories')) db.createObjectStore('categories', { keyPath: 'id' });
                        if (!db.objectStoreNames.contains('coupons')) db.createObjectStore('coupons', { keyPath: 'code' });
                        if (!db.objectStoreNames.contains('settings')) db.createObjectStore('settings', { keyPath: 'key' });
                    };
                    request.onsuccess = (e) => {
                        db = e.target.result;
                        resolve(db);
                    };
                });
            },
            async getAll(storeName) {
                return new Promise((resolve) => {
                    const tx = db.transaction(storeName, 'readonly');
                    const store = tx.objectStore(storeName);
                    const req = store.getAll();
                    req.onsuccess = () => resolve(req.result);
                });
            },
            async put(storeName, item) {
                return new Promise((resolve) => {
                    const tx = db.transaction(storeName, 'readwrite');
                    const store = tx.objectStore(storeName);
                    store.put(item);
                    tx.oncomplete = () => resolve();
                });
            },
            async delete(storeName, key) {
                return new Promise((resolve) => {
                    const tx = db.transaction(storeName, 'readwrite');
                    const store = tx.objectStore(storeName);
                    store.delete(key);
                    tx.oncomplete = () => resolve();
                });
            }
        };

        // --- Data ---
        let products = [], categories = [], coupons = [], siteConfig = { collectionTitle: "Nova Cole√ß√£o" };
        let cart = [], activeCategory = 'all', checkoutData = { name: '', address: '', payment: '' }, checkoutStep = 0, appliedCoupon = null;
        const whatsappNumber = "5584933004076";

        const allColors = [
            { name: "Preto", hex: "#111111" }, { name: "Branco", hex: "#FFFFFF" }, { name: "Vermelho", hex: "#DC2626" },
            { name: "Vinho", hex: "#4a0404" }, { name: "Azul", hex: "#191970" }, { name: "Nude", hex: "#d4a574" },
            { name: "Bordeaux", hex: "#800020" }, { name: "Cacau", hex: "#3e2723" }, { name: "P√©rola", hex: "#eae0c8" },
            { name: "Rubi", hex: "#9b111e" }, { name: "Violeta", hex: "#2e003e" }, { name: "Rosa", hex: "#ffc0cb" }
        ];

        // Seed Data
        const initialProducts = [
            { id: 1, name: "Conjunto Renda Noir", price: 189.90, promoPrice: 0, category: "conjuntos", colors: ["Preto", "Vinho"], sizes: ["P", "M", "G", "GG"], icon: "üñ§", description: "Sofistica√ß√£o em cada detalhe. Renda francesa premium.", visible: true, isPromotion: false },
            { id: 2, name: "Conjunto Midnight", price: 129.90, promoPrice: 0, category: "conjuntos", colors: ["Azul", "Preto"], sizes: ["P", "M", "G"], icon: "üåë", description: "Toque aveludado para conforto absoluto.", visible: true, isPromotion: false },
            { id: 3, name: "Suti√£ Velvet", price: 99.90, promoPrice: 0, category: "sutias", colors: ["Bordeaux", "Preto"], sizes: ["P", "M", "G", "GG"], icon: "‚ú®", description: "Acabamento em veludo. Modelagem perfeita.", visible: true, isPromotion: false },
            { id: 4, name: "Suti√£ Invisible", price: 69.90, promoPrice: 0, category: "sutias", colors: ["Nude", "Preto"], sizes: ["P", "M", "G"], icon: "üëÅÔ∏è", description: "Design minimalista. Invis√≠vel sob a roupa.", visible: true, isPromotion: false },
            { id: 5, name: "Fio Dental Lace", price: 49.90, promoPrice: 0, category: "calcinhas", colors: ["Vermelho", "Preto"], sizes: ["P", "M", "G"], icon: "üåπ", description: "Delicadeza e transpar√™ncia estrat√©gica.", visible: true, isPromotion: false },
            { id: 6, name: "Cintura Alta Sculpt", price: 59.90, promoPrice: 0, category: "calcinhas", colors: ["Preto", "Cacau"], sizes: ["P", "M", "G", "GG"], icon: "üíé", description: "Modelagem retr√¥ chic que desenha a silhueta.", visible: true, isPromotion: false }
        ];
        const initialCategories = [
            { id: 'all', label: 'Todos' }, { id: 'conjuntos', label: 'Conjuntos' }, { id: 'sutias', label: 'Suti√£s' },
            { id: 'calcinhas', label: 'Calcinhas' }, { id: 'bodies', label: 'Bodies' }, { id: 'camisolas', label: 'Camisolas' }
        ];
        const initialCoupons = [{ code: "BELLE10", discount: 10 }];

        // --- Core ---
        async function initApp() {
            try {
                await IDB.open();
                await loadData();
            } catch (e) {
                products = initialProducts; categories = initialCategories; coupons = initialCoupons;
                renderUI();
            }
        }

        async function loadData() {
            const cats = await IDB.getAll('categories');
            categories = cats.length ? cats : initialCategories;
            if(!cats.length) initialCategories.forEach(c => IDB.put('categories', c));

            const prods = await IDB.getAll('products');
            products = prods.length ? prods : initialProducts;
            if(!prods.length) initialProducts.forEach(p => IDB.put('products', p));

            const cups = await IDB.getAll('coupons');
            coupons = cups.length ? cups : initialCoupons;
            if(!cups.length) initialCoupons.forEach(c => IDB.put('coupons', c));

            const settings = await IDB.getAll('settings');
            const config = settings.find(s => s.key === 'config');
            if (config) siteConfig = config.value;
            
            renderUI();
        }

        function renderUI() {
            document.getElementById('hero-collection-title').textContent = siteConfig.collectionTitle;
            renderCategories();
            renderProducts();
        }

        function renderCategories() {
            document.getElementById('categories').innerHTML = categories.map(cat => `
                <button class="category-btn px-4 py-1.5 rounded-full text-sm font-medium transition-all whitespace-nowrap ${activeCategory === cat.id ? 'bg-white text-black' : 'text-gray-400 hover:text-white'}" onclick="setCategory('${cat.id}')">${cat.label}</button>
            `).join('');
        }

        function setCategory(id) { activeCategory = id; renderCategories(); renderProducts(); }

        function renderProducts() {
            const grid = document.getElementById('products-grid');
            const promoSection = document.getElementById('promotions-section');
            const promoList = document.getElementById('promotions-list');
            const catalogTitle = document.getElementById('catalog-title');

            const visible = products.filter(p => p.visible !== false);
            const promos = visible.filter(p => p.isPromotion);
            const normal = visible.filter(p => !p.isPromotion);

            if (promos.length > 0) {
                promoSection.classList.remove('hidden');
                catalogTitle.classList.remove('hidden');
                promoList.innerHTML = promos.map(p => {
                    const imgUrl = getValidImageUrl(p.image);
                    const img = imgUrl ? `<img src="${imgUrl}" class="w-full h-full object-cover object-top transition-transform duration-500 group-hover:scale-110">` : `<span class="text-5xl transition-transform duration-500 group-hover:scale-110">${p.icon}</span>`;
                    const price = p.promoPrice > 0 ? p.promoPrice : p.price;
                    
                    return `
                        <div class="snap-center shrink-0 w-[240px] bg-ios-card rounded-[24px] overflow-hidden group cursor-pointer border border-ios-red/20 hover:border-ios-red/50 transition-all" onclick="openProductModal(${p.id})">
                            <div class="h-[280px] relative bg-gradient-to-br from-[#2c2c2e] to-[#1c1c1e] flex items-center justify-center overflow-hidden">
                                ${img}
                                <div class="absolute top-3 right-3 bg-ios-red text-white text-[10px] font-bold px-2 py-1 rounded-full uppercase tracking-wide">Promo</div>
                                <div class="absolute bottom-4 left-4 right-4 bg-black/60 backdrop-blur-md px-3 py-2 rounded-xl border border-white/10 flex justify-between items-center">
                                    <span class="text-white font-bold text-sm">R$ ${price.toFixed(0)}</span>
                                    <span class="text-xs text-gray-300 line-through">R$ ${p.price.toFixed(0)}</span>
                                </div>
                            </div>
                            <div class="p-4">
                                <h3 class="text-white font-bold text-sm leading-tight line-clamp-1">${p.name}</h3>
                                <p class="text-gray-500 text-xs mt-1">Ver detalhes</p>
                            </div>
                        </div>`;
                }).join('');
            } else {
                promoSection.classList.add('hidden');
                catalogTitle.classList.add('hidden');
            }

            const filtered = activeCategory === 'all' ? normal : normal.filter(p => p.category === activeCategory);
            grid.innerHTML = filtered.length === 0 ? `<div class="col-span-full py-20 text-center"><p class="text-gray-500 text-lg">Nenhum produto encontrado.</p></div>` : 
            filtered.map(p => {
                const imgUrl = getValidImageUrl(p.image);
                const img = imgUrl ? `<img src="${imgUrl}" class="w-full h-full object-cover object-top transition-transform duration-500 group-hover:scale-110">` : `<span class="text-6xl transition-transform duration-500 group-hover:scale-110">${p.icon}</span>`;
                return `
                <div class="bg-ios-card rounded-[24px] overflow-hidden group cursor-pointer animate-scale-in border border-white/5 hover:bg-[#2c2c2e] transition-colors" onclick="openProductModal(${p.id})">
                    <div class="aspect-[4/5] bg-gradient-to-br from-[#2c2c2e] to-[#1c1c1e] relative flex items-center justify-center overflow-hidden">
                        ${img}
                        <div class="absolute bottom-4 right-4 bg-black/60 backdrop-blur-md px-3 py-1 rounded-full border border-white/10">
                            <span class="text-xs font-semibold text-white">R$ ${p.price.toFixed(0)}</span>
                        </div>
                    </div>
                    <div class="p-5">
                        <p class="text-xs text-ios-blue font-semibold uppercase tracking-wide mb-1">${categories.find(c=>c.id===p.category)?.label || p.category}</p>
                        <h3 class="text-white font-semibold text-lg leading-tight mb-2">${p.name}</h3>
                        <p class="text-gray-500 text-sm line-clamp-2">${p.description}</p>
                    </div>
                </div>`;
            }).join('');
        }

        function openProductModal(id) {
            const p = products.find(x => x.id === id);
            const content = document.getElementById('modal-content');
            const imgUrl = getValidImageUrl(p.image);
            const img = imgUrl ? `<img src="${imgUrl}" class="w-full h-full object-cover object-top animate-scale-in">` : `<span class="text-9xl drop-shadow-2xl animate-scale-in">${p.icon}</span>`;
            
            const price = (p.isPromotion && p.promoPrice > 0) ? p.promoPrice : p.price;
            const priceHtml = (p.isPromotion && p.promoPrice > 0) ? 
                `<p class="text-xl text-ios-red font-bold">R$ ${price.toFixed(2).replace('.', ',')} <span class="text-base text-gray-500 font-normal line-through ml-2">R$ ${p.price.toFixed(2).replace('.', ',')}</span></p>` :
                `<p class="text-xl text-ios-gray">R$ ${p.price.toFixed(2).replace('.', ',')}</p>`;

            content.innerHTML = `
                <div class="relative h-[40vh] bg-gradient-to-b from-[#2c2c2e] to-ios-card flex items-center justify-center shrink-0">
                    <button onclick="closeProductModal()" class="absolute top-4 left-4 bg-black/20 backdrop-blur-md p-2 rounded-full text-white hover:bg-black/40 transition-colors z-10"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg></button>
                    ${img}
                </div>
                <div class="p-8 flex flex-col flex-1">
                    <div class="mb-6"><div class="flex justify-between items-start"><h2 class="text-3xl font-bold text-white mb-2 max-w-[80%]">${p.name}</h2>${p.isPromotion ? '<span class="bg-ios-red text-white text-xs font-bold px-2 py-1 rounded">PROMO</span>' : ''}</div>${priceHtml}</div>
                    <div class="space-y-8 flex-1">
                        <div><label class="text-sm font-medium text-gray-400 block mb-3">Cor</label><div class="flex gap-3 flex-wrap">${p.colors.map((c,i)=>`<button class="w-10 h-10 rounded-full border-2 transition-all color-btn ${i===0?'border-ios-blue scale-110':'border-transparent hover:border-gray-600'}" style="background-color: ${allColors.find(ac=>ac.name===c)?.hex||'#333'}" data-color="${c}" onclick="selectColor(this)"></button>`).join('')}</div></div>
                        <div><label class="text-sm font-medium text-gray-400 block mb-3">Tamanho</label><div class="flex gap-3">${p.sizes.map((s,i)=>`<button class="w-12 h-12 rounded-full bg-[#2c2c2e] text-white font-medium text-sm transition-all size-btn hover:bg-[#3a3a3c] ${i===0?'ring-2 ring-ios-blue bg-[#3a3a3c]':''} selected" data-size="${s}" onclick="selectSize(this)">${s}</button>`).join('')}</div></div>
                        <div class="bg-[#2c2c2e] p-4 rounded-xl"><p class="text-sm text-gray-400 leading-relaxed">${p.description}</p></div>
                    </div>
                    <div class="mt-8 pt-6 border-t border-white/5"><button onclick="addToCart(${p.id})" class="w-full bg-ios-blue text-white py-4 rounded-xl font-semibold text-lg btn-ios hover:bg-blue-600">Adicionar √† Sacola</button></div>
                </div>`;
            
            document.getElementById('product-modal').classList.remove('hidden');
            setTimeout(() => { document.getElementById('modal-backdrop').classList.remove('opacity-0'); document.getElementById('modal-panel').classList.remove('translate-x-full'); }, 10);
            document.body.style.overflow = 'hidden';
        }

        // --- Helpers ---
        function selectColor(btn) { btn.parentElement.querySelectorAll('.color-btn').forEach(b => {b.classList.remove('border-ios-blue', 'scale-110'); b.classList.add('border-transparent')}); btn.classList.remove('border-transparent'); btn.classList.add('border-ios-blue', 'scale-110'); btn.classList.add('selected'); }
        function selectSize(btn) { btn.parentElement.querySelectorAll('.size-btn').forEach(b => b.classList.remove('ring-2', 'ring-ios-blue')); btn.classList.add('ring-2', 'ring-ios-blue'); btn.classList.add('selected'); }
        function closeProductModal() { const m = document.getElementById('product-modal'); document.getElementById('modal-backdrop').classList.add('opacity-0'); document.getElementById('modal-panel').classList.add('translate-x-full'); setTimeout(() => { m.classList.add('hidden'); document.body.style.overflow = ''; }, 500); }

        function addToCart(id) {
            const p = products.find(x => x.id === id);
            const content = document.getElementById('modal-content');
            const color = (content.querySelector('.color-btn.selected') || content.querySelector('.color-btn'))?.dataset.color;
            const size = (content.querySelector('.size-btn.selected') || content.querySelector('.size-btn'))?.dataset.size;
            
            const exist = cart.find(i => i.id === id && i.color === color && i.size === size);
            if(exist) exist.quantity++;
            else cart.push({...p, color, size, quantity: 1});
            
            updateCartUI(); closeProductModal(); openCart();
        }

        function removeFromCart(i) { cart.splice(i, 1); updateCartUI(); }
        
        function applyCoupon() {
            const val = document.getElementById('coupon-input').value.toUpperCase().trim();
            const c = coupons.find(x => x.code === val);
            const msg = document.getElementById('coupon-message');
            if(c) { appliedCoupon = c; msg.textContent = `Cupom ${c.code}: ${c.discount}% OFF`; msg.className = "text-xs text-ios-green mt-1 block"; }
            else { appliedCoupon = null; msg.textContent = "Inv√°lido"; msg.className = "text-xs text-ios-red mt-1 block"; }
            updateCartUI();
        }

        function updateCartUI() {
            const count = cart.reduce((a,b)=>a+b.quantity,0);
            let sub = cart.reduce((a,b) => { const price = (b.isPromotion && b.promoPrice > 0) ? b.promoPrice : b.price; return a + (price * b.quantity); }, 0);
            let total = sub;
            if(appliedCoupon) {
                const disc = (sub * appliedCoupon.discount) / 100;
                total -= disc;
                document.getElementById('discount-display').textContent = `-${appliedCoupon.discount}% (R$ -${disc.toFixed(2)})`;
                document.getElementById('discount-display').classList.remove('hidden');
            } else {
                document.getElementById('discount-display').classList.add('hidden');
            }
            document.getElementById('cart-count').textContent = count;
            document.getElementById('cart-count').classList.toggle('hidden', count === 0);
            document.getElementById('cart-total').textContent = `R$ ${total.toFixed(2).replace('.', ',')}`;
            
            const items = document.getElementById('cart-items');
            if(!cart.length) { items.innerHTML = `<div class="flex flex-col items-center justify-center h-full text-center py-10"><div class="w-16 h-16 bg-white/5 rounded-full flex items-center justify-center mb-4 text-2xl">üõçÔ∏è</div><p class="text-white">Sacola vazia</p></div>`; document.getElementById('checkout-btn').disabled = true; }
            else {
                items.innerHTML = cart.map((item, idx) => {
                    const price = (item.isPromotion && item.promoPrice > 0) ? item.promoPrice : item.price;
                    const imgUrl = getValidImageUrl(item.image);
                    const img = imgUrl ? `<img src="${imgUrl}" class="w-full h-full object-cover">` : item.icon;
                    return `<div class="flex gap-4"><div class="w-16 h-20 bg-[#2c2c2e] rounded-lg flex items-center justify-center text-2xl shrink-0 overflow-hidden">${img}</div><div class="flex-1 py-1"><div class="flex justify-between items-start"><h4 class="text-white font-medium text-sm">${item.name}</h4><button onclick="removeFromCart(${idx})" class="text-gray-500 hover:text-red-500">√ó</button></div><p class="text-gray-500 text-xs mt-1">${item.size} ‚Ä¢ ${item.color}</p><div class="flex justify-between items-end mt-2"><p class="text-white text-sm">R$ ${price.toFixed(2).replace('.', ',')}</p><div class="text-gray-400 text-xs bg-white/5 px-2 py-1 rounded">x${item.quantity}</div></div></div></div>`;
                }).join('');
                document.getElementById('checkout-btn').disabled = false;
            }
        }

        // Admin & Nav
        function openCart() { document.getElementById('cart-sidebar').classList.remove('translate-x-full'); }
        function closeCart() { document.getElementById('cart-sidebar').classList.add('translate-x-full'); }
        document.getElementById('cart-btn').addEventListener('click', openCart);
        document.getElementById('close-cart').addEventListener('click', closeCart);
        document.getElementById('checkout-btn').addEventListener('click', checkout);

        function openAdminLogin() { document.getElementById('admin-login-modal').classList.remove('hidden'); }
        function closeAdminLogin() { document.getElementById('admin-login-modal').classList.add('hidden'); document.getElementById('admin-password-input').value = ''; }
        function checkAdminPassword() { if(document.getElementById('admin-password-input').value === "NEILAQUEIROZ") { closeAdminLogin(); openAdminDashboard(); } else alert("Senha incorreta"); }
        function openAdminDashboard() { document.getElementById('admin-dashboard-modal').classList.remove('hidden'); switchAdminTab('products'); renderAdminProducts(); }
        function closeAdminDashboard() { document.getElementById('admin-dashboard-modal').classList.add('hidden'); }
        
        function switchAdminTab(t) { ['products','categories','coupons','settings'].forEach(x=>document.getElementById(`admin-tab-${x}`).classList.add('hidden')); document.getElementById(`admin-tab-${t}`).classList.remove('hidden'); if(t==='categories') renderAdminCategories(); if(t==='coupons') renderAdminCoupons(); if(t==='settings') document.getElementById('setting-collection-title').value = siteConfig.collectionTitle; }

        function renderAdminProducts() {
            document.getElementById('admin-products-list').innerHTML = products.map(p => {
                const imgUrl = getValidImageUrl(p.image);
                const img = imgUrl ? `<img src="${imgUrl}" class="w-full h-full object-cover">` : p.icon;
                return `<div class="bg-white/5 p-4 rounded-xl flex justify-between items-center border border-white/5"><div class="flex gap-4 items-center flex-1"><div class="w-12 h-12 bg-white/10 rounded-lg flex items-center justify-center text-2xl overflow-hidden shrink-0">${img}</div><div><h4 class="font-bold text-white ${!p.visible?'opacity-50':''}">${p.name}</h4><p class="text-xs text-gray-400">R$ ${p.price.toFixed(2)} ‚Ä¢ ${p.category} ${p.isPromotion?'<span class="text-ios-red ml-1">PROMO</span>':''} ${!p.visible?'<span class="text-gray-500">(Oculto)</span>':''}</p></div></div><div class="flex items-center gap-4"><div class="flex items-center"><label class="relative inline-flex items-center cursor-pointer"><input type="checkbox" ${p.visible!==false?'checked':''} onchange="toggleProductVisibility(${p.id})" class="sr-only peer"><div class="w-9 h-5 bg-gray-600 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-4 after:w-4 after:transition-all peer-checked:bg-ios-green"></div></label></div><button onclick="editProduct(${p.id})" class="text-ios-blue text-sm font-medium">Editar</button></div></div>`;
            }).join('');
        }

        async function toggleProductVisibility(id) { const i = products.findIndex(p=>p.id===id); if(i!==-1) { products[i].visible = !products[i].visible; if(products[i].visible===undefined) products[i].visible=true; await IDB.put('products', products[i]); renderAdminProducts(); renderProducts(); } }
        
        function openProductForm(isEdit=false, id=null) {
            document.getElementById('admin-product-form').classList.remove('hidden');
            document.getElementById('prod-category').innerHTML = categories.map(c=>`<option value="${c.id}" class="text-black">${c.label}</option>`).join('');
            document.getElementById('color-selection-grid').innerHTML = allColors.map(c=>`<label class="cursor-pointer"><input type="checkbox" name="prod-colors" value="${c.name}" class="hidden admin-checkbox"><div class="border border-white/10 rounded-lg p-2 flex items-center gap-2 hover:bg-white/5 transition-colors"><div class="w-4 h-4 rounded-full border border-gray-600" style="background-color: ${c.hex}"></div><span class="text-xs text-gray-300">${c.name}</span></div></label>`).join('');
            
            if(isEdit && id) {
                const p = products.find(x => x.id === id);
                document.getElementById('edit-prod-id').value = p.id;
                document.getElementById('prod-name').value = p.name;
                document.getElementById('prod-price').value = p.price;
                document.getElementById('prod-category').value = p.category;
                document.getElementById('prod-image').value = p.image || '';
                document.getElementById('prod-icon').value = p.icon;
                document.getElementById('prod-desc').value = p.description;
                document.getElementById('prod-is-promo').checked = p.isPromotion || false;
                document.getElementById('prod-promo-price').value = p.promoPrice || '';
                document.getElementById('btn-delete-prod').classList.remove('hidden');
                document.querySelectorAll('input[name="prod-colors"]').forEach(cb => { if(p.colors.includes(cb.value)) cb.checked = true; });
            } else {
                document.getElementById('edit-prod-id').value = '';
                document.getElementById('prod-name').value = '';
                document.getElementById('prod-price').value = '';
                document.getElementById('prod-image').value = '';
                document.getElementById('prod-icon').value = '‚ú®';
                document.getElementById('prod-desc').value = '';
                document.getElementById('prod-is-promo').checked = false;
                document.getElementById('prod-promo-price').value = '';
                document.getElementById('btn-delete-prod').classList.add('hidden');
                document.querySelectorAll('input[name="prod-colors"]').forEach(cb => cb.checked = false);
            }
        }
        
        function closeProductForm() { document.getElementById('admin-product-form').classList.add('hidden'); }
        function editProduct(id) { openProductForm(true, id); }
        
        async function saveProduct() {
            const id = document.getElementById('edit-prod-id').value;
            const name = document.getElementById('prod-name').value;
            const price = parseFloat(document.getElementById('prod-price').value);
            const category = document.getElementById('prod-category').value;
            const image = document.getElementById('prod-image').value;
            const icon = document.getElementById('prod-icon').value;
            const description = document.getElementById('prod-desc').value;
            const isPromotion = document.getElementById('prod-is-promo').checked;
            const promoPrice = isPromotion ? parseFloat(document.getElementById('prod-promo-price').value) : 0;
            const colors = Array.from(document.querySelectorAll('input[name="prod-colors"]:checked')).map(cb => cb.value);

            if(!name || !price || !colors.length) { alert("Preencha nome, pre√ßo e cores."); return; }
            if(isPromotion && (!promoPrice || isNaN(promoPrice))) { alert("Informe o pre√ßo promocional."); return; }

            let prodData;
            if(id) {
                const idx = products.findIndex(p => p.id == id);
                if(idx !== -1) {
                    prodData = { ...products[idx], name, price, category, image, icon, description, colors, isPromotion, promoPrice };
                    products[idx] = prodData;
                }
            } else {
                const newId = products.length ? Math.max(...products.map(p=>p.id)) + 1 : 1;
                prodData = { id: newId, name, price, category, image, icon, description, colors, sizes: ["P", "M", "G"], visible: true, isPromotion, promoPrice };
                products.push(prodData);
            }
            await IDB.put('products', prodData);
            closeProductForm(); renderAdminProducts(); renderProducts();
        }

        async function deleteProduct() {
            const id = parseInt(document.getElementById('edit-prod-id').value);
            if(confirm("Excluir?")) { await IDB.delete('products', id); products = products.filter(p=>p.id!=id); closeProductForm(); renderAdminProducts(); renderProducts(); }
        }

        function renderAdminCategories() { document.getElementById('admin-categories-list').innerHTML = categories.map(c=>`<div class="bg-white/5 p-3 rounded-lg flex justify-between items-center"><span class="text-white">${c.label}</span>${c.id!=='all'?`<button onclick="deleteCategory('${c.id}')" class="text-red-500 text-xs">Excluir</button>`:''}</div>`).join(''); }
        async function addCategory() { const id = document.getElementById('new-cat-input').value.toLowerCase().replace(/\s+/g,'-'); const label = document.getElementById('new-cat-label').value; if(id&&label) { const c = {id,label}; categories.push(c); await IDB.put('categories', c); renderAdminCategories(); renderCategories(); document.getElementById('new-cat-input').value=''; document.getElementById('new-cat-label').value=''; } }
        async function deleteCategory(id) { if(confirm("Excluir?")) { await IDB.delete('categories', id); categories = categories.filter(c=>c.id!==id); renderAdminCategories(); renderCategories(); } }

        function renderAdminCoupons() { document.getElementById('admin-coupons-list').innerHTML = coupons.map(c=>`<div class="bg-white/5 p-3 rounded-lg flex justify-between items-center"><span class="text-white font-mono">${c.code}</span><span class="text-ios-green">${c.discount}%</span><button onclick="deleteCoupon('${c.code}')" class="text-red-500 text-xs">Excluir</button></div>`).join(''); }
        async function addCoupon() { const code = document.getElementById('new-coupon-code').value.toUpperCase(); const val = parseFloat(document.getElementById('new-coupon-val').value); if(code&&val) { const c = {code, discount: val}; coupons.push(c); await IDB.put('coupons', c); renderAdminCoupons(); document.getElementById('new-coupon-code').value=''; document.getElementById('new-coupon-val').value=''; } }
        async function deleteCoupon(c) { await IDB.delete('coupons', c); coupons = coupons.filter(x=>x.code!==c); renderAdminCoupons(); }

        async function saveSettings() {
            const val = document.getElementById('setting-collection-title').value;
            if(!val.trim()) { alert("T√≠tulo vazio!"); return; }
            siteConfig.collectionTitle = val;
            await IDB.put('settings', { key: 'config', value: siteConfig });
            const t = document.getElementById('hero-collection-title'); t.textContent = val; t.classList.remove('animate-fade-in'); void t.offsetWidth; t.classList.add('animate-fade-in');
            alert("Salvo!");
        }

        // Checkout
        function checkout() { if(!cart.length) return; checkoutStep = 0; checkoutData = { name: '', address: '', payment: '' }; renderCheckoutModal(); }
        function renderCheckoutModal() {
            const m = document.getElementById('checkout-modal'); m.classList.remove('hidden'); setTimeout(() => document.getElementById('checkout-panel').classList.remove('scale-95', 'opacity-0'), 10);
            const content = document.getElementById('checkout-modal-content');
            const inputClass = "w-full bg-[#2c2c2e] text-white px-4 py-3 rounded-xl outline-none focus:ring-2 focus:ring-ios-blue transition-all placeholder-gray-500 text-sm";
            
            if(checkoutStep===0) content.innerHTML = `<div class="p-6"><div class="text-center mb-6"><h3 class="text-lg font-bold text-white">Identifica√ß√£o</h3></div><form onsubmit="nextCheckoutStep(event, 'name')"><input type="text" name="name" required class="${inputClass}" value="${checkoutData.name}" placeholder="Nome Completo" autofocus><div class="flex gap-3 mt-6"><button type="button" onclick="closeCheckoutModal()" class="flex-1 py-3 text-sm text-gray-400">Cancelar</button><button type="submit" class="flex-1 py-3 bg-ios-blue text-white text-sm font-medium rounded-xl">Continuar</button></div></form></div>`;
            else if(checkoutStep===1) content.innerHTML = `<div class="p-6"><div class="text-center mb-6"><h3 class="text-lg font-bold text-white">Entrega</h3></div><form onsubmit="nextCheckoutStep(event, 'address')"><textarea name="address" required class="${inputClass} resize-none" rows="3" placeholder="Endere√ßo Completo">${checkoutData.address}</textarea><div class="flex gap-3 mt-6"><button type="button" onclick="prevCheckoutStep()" class="flex-1 py-3 text-sm text-gray-400">Voltar</button><button type="submit" class="flex-1 py-3 bg-ios-blue text-white text-sm font-medium rounded-xl">Continuar</button></div></form></div>`;
            else if(checkoutStep===2) content.innerHTML = `<div class="p-6"><div class="text-center mb-6"><h3 class="text-lg font-bold text-white">Pagamento</h3></div><form onsubmit="nextCheckoutStep(event, 'payment')"><div class="space-y-3"><label class="flex items-center p-3 rounded-xl bg-[#2c2c2e] cursor-pointer"><input type="radio" name="payment" value="PIX" class="text-ios-blue bg-black" required><span class="ml-3 text-sm text-white">PIX</span></label><label class="flex items-center p-3 rounded-xl bg-[#2c2c2e] cursor-pointer"><input type="radio" name="payment" value="Cart√£o" class="text-ios-blue bg-black"><span class="ml-3 text-sm text-white">Cart√£o</span></label></div><div class="flex gap-3 mt-6"><button type="button" onclick="prevCheckoutStep()" class="flex-1 py-3 text-sm text-gray-400">Voltar</button><button type="submit" class="flex-1 py-3 bg-ios-blue text-white text-sm font-medium rounded-xl">Finalizar</button></div></form></div>`;
        }
        function nextCheckoutStep(e, f) { e.preventDefault(); checkoutData[f] = new FormData(e.target).get(f); if(checkoutStep<2) { checkoutStep++; renderCheckoutModal(); } else sendToWhatsApp(); }
        function prevCheckoutStep() { checkoutStep--; renderCheckoutModal(); }
        function closeCheckoutModal() { const m = document.getElementById('checkout-modal'); document.getElementById('checkout-panel').classList.add('scale-95', 'opacity-0'); setTimeout(() => m.classList.add('hidden'), 200); }
        
        function sendToWhatsApp() {
            let msg = `*PEDIDO BELLE LINGERIE*\n\nüë§ *Cliente:* ${checkoutData.name}\nüìç *Endere√ßo:* ${checkoutData.address}\nüí≥ *Pagamento:* ${checkoutData.payment}\n\nüõí *ITENS:*`;
            cart.forEach(i => msg += `\n- ${i.quantity}x ${i.name} (${i.size}, ${i.color})`);
            let sub = cart.reduce((a,b) => { const p = (b.isPromotion && b.promoPrice > 0) ? b.promoPrice : b.price; return a + (p * b.quantity); }, 0);
            let total = sub;
            if(appliedCoupon) { const d = (sub * appliedCoupon.discount) / 100; total -= d; msg += `\n\nüè∑Ô∏è *Cupom:* ${appliedCoupon.code} (-${appliedCoupon.discount}%)`; }
            msg += `\n\nüí∞ *Total:* R$ ${total.toFixed(2).replace('.', ',')}`;
            window.open(`https://wa.me/${whatsappNumber}?text=${encodeURIComponent(msg)}`, '_blank');
            cart = []; appliedCoupon = null; updateCartUI(); closeCheckoutModal(); closeCart();
        }

        initApp();
    </script>
</body>
</html>